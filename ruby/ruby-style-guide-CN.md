
# Ruby 代码风格指南


### 源代码布局
1. 所有源文件以UTF-8编码
2. 使用2个空格的缩进
3. 使用Unix风格的换行符`\n`
	- 如果你使用 Git，可用下面这个配置来保护你的项目不被 Windows 的换行符干扰
	
		```
			可使用git config --global core.autocrlf true 防止产生windows风格的换行符
		```
4. 在`,` `;`后，操作符（除指数操作之外），`{` `}`的前后增加空格，增加代码的可读性
5. 在`(` `)`，`[` `]`符号后不要加空格
6. `Case`和`When`处于同一代码层次
7. 2个def之间使用一个空行隔开
8. 对于一个方法有多个参数导致太长的时候，按如下方式处理

	```ruby
	def send_mail(source)
	   Mailer.deliver(to: 'bob@example.com',
	                  from: 'us@example.com',
	                  subject: 'Important message',
	                  body: source.text)
	end
	```
9. 使用Rdoc生产系统的API文档，在注释和def之间不要有空行
10. 每行不超过80行
11. 每行的结尾不要有空白字符

--

### 语法
1. 一个方法如果没参数就省略括号，有参数就使用括号
2. 如无必要，不要使用`for`，而使用`each`做循环
3. 不要使用`then`
4. 使用三元操作`? : `代替`if...else`
5. 不要在`if...else`的内部使用`? : `操作符
6. 使用`when X then ...`，因为它在ruby1.9被删除了
7. 使用`&&`和`||`做boolean操作，使用`and`和`or`做流程控制
8. `unless`和`else`不要一起用
9. 除非是判断条件涉及赋值操作，否则不不需要括起来
10. 把多行语句块使用`{}`包含，
11. 不需要使用的`return`的时候就不要用
12. 不要使用`\`连接2行代码
13. 使用`||=`来初始化变量，但是不能用来初始化`boolean`变量
14. 运行Ruby的时候，加上`-w`以提示我们代码中不好的地方
15. 使用`Ruby1.9`的语法写lambda和hash

--

### 命名规范
1. 使用小写+`_`命名变量和方法
2. 使用首字母大写命名Module和Class
3. 使用全大写+`_`命名常量
4. 对于返回值是boolean的方法加个`?`后缀
5. 对于一些有潜在风险的方法加`!`后缀，比方说有exit，修改了self，或者变量等等

--

### 注释
1.代码即注释，努力消除注释

--

### 类
1. 符合liskov原则，子类可以替换父类
2. 尽量让类做到SOLID (Single responsibility, Open-closed, Liskov substitution, Interface segregation and Dependency inversion)
3. 为每个类都写一个`to_s`的方法以查看类的状态
4. 使用attr家族的方法做类属性的访问控制
5. 考虑增加新的工厂方法做一些有意义的实例初始化工作
6. 使用DuckTyping而非继承因为动态语言的特性，不在需要多态了
7. 避免使用`@@`，全局变量，
8. 根据访问情况，合理使用访问控制符
9. 使用self来定义单例方法，而不是使用类名

--

### 异常
1. 不要放过一些异常
2. 不要使用异常做流程控制
3. 不要捕获Exception，异常基类
4. 根据异常类型的覆盖面排列异常
5. 把所有的外部资源放到异常捕获模块中
6. 优先使用库自带的异常，而不是自己创建异常

--

### 集合
1. 优先使用`%w`创建字符串数组
2. 按需创建数组
3. 使用Set去除List中的重复元素
4. 使用Symbol做Hash key，而不是String，不要使用可变对象做Hash Key
5. 不要在遍历一个列表的同时，又在改变它

--

### Strings
1. 使用`#{String} #{string}`优于`String+String`
2. 未使用#{}形式的String时，使用`''`表示
3. 在做实例变量的连接时，不要使用{}
4. 使用<<而不是+做字符串串联

--

### 正则表达式
1. 使用命名组而非$1-9以便于跟踪
2. `^` `$`表示匹配整行，匹配整个字符串应使用`\A` `\Z`
3. 使用`x`修饰符修饰复杂的regex语句，增加可读性，但是注意空格的去除问题

--

### %的语法
1. 多使用`%w`
2. 需要字符串内嵌表达式的时候使用`%()`
3. 使用`%r`当正则表达式中出现多个`/`
4. 不要使用 `%q` `%Q` `%x` `%W` `%s`这些字符
5. 在`%`后优先使用`()`作为分隔符


### 参考
[Ruby Style Guide](https://github.com/bbatsov/ruby-style-guide)

